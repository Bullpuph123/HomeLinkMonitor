<Window x:Class="HomeLinkMonitor.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:lvc="clr-namespace:LiveChartsCore.SkiaSharpView.WPF;assembly=LiveChartsCore.SkiaSharpView.WPF"
        xmlns:vm="clr-namespace:HomeLinkMonitor.ViewModels"
        xmlns:conv="clr-namespace:HomeLinkMonitor.Converters"
        mc:Ignorable="d"
        Title="HomeLink Monitor"
        Height="700" Width="1100"
        MinHeight="500" MinWidth="800"
        Icon="Assets/app.ico"
        Background="{DynamicResource BackgroundBrush}"
        Foreground="{DynamicResource TextPrimaryBrush}"
        WindowStartupLocation="CenterScreen">

    <Window.Resources>
        <conv:SignalToColorConverter x:Key="SignalToColor" />
        <conv:LatencyToColorConverter x:Key="LatencyToColor" />
        <conv:ConnectionStatusToColorConverter x:Key="StatusToColor" />
        <conv:ConnectionStatusToTextConverter x:Key="StatusToText" />
        <conv:BoolToVisibilityConverter x:Key="BoolToVis" />
    </Window.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Title Bar -->
        <Border Grid.Row="0" Background="{DynamicResource SurfaceBrush}" Padding="16,10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!-- Status Indicator + Title -->
                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                    <Ellipse Width="12" Height="12"
                             Fill="{Binding OverallStatus, Converter={StaticResource StatusToColor}}"
                             Margin="0,0,10,0" />
                    <TextBlock Text="HomeLink Monitor" FontSize="16" FontWeight="SemiBold"
                               Foreground="{DynamicResource TextPrimaryBrush}" />
                    <TextBlock Text="{Binding StatusText}" FontSize="12" Margin="12,2,0,0"
                               Foreground="{DynamicResource TextSecondaryBrush}" VerticalAlignment="Center" />
                </StackPanel>

                <!-- Toolbar buttons -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" HorizontalAlignment="Right">
                    <Button Content="Traceroute" Style="{DynamicResource SubtleButton}"
                            x:Name="TracerouteButton"
                            ToolTip="Run a traceroute" Margin="4,0" />
                    <Button Content="Mini" Style="{DynamicResource SubtleButton}"
                            Command="{Binding SwitchToMiniModeCommand}"
                            ToolTip="Switch to compact mode" Margin="4,0" />
                    <Button Content="Settings" Style="{DynamicResource SubtleButton}"
                            x:Name="SettingsButton"
                            ToolTip="Open settings" Margin="4,0" />
                </StackPanel>
            </Grid>
        </Border>

        <!-- Top Metrics Row -->
        <Grid Grid.Row="1" Margin="10,6,10,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <!-- Signal Quality -->
            <Border Grid.Column="0" Style="{DynamicResource CardPanel}">
                <StackPanel>
                    <TextBlock Text="SIGNAL" Style="{DynamicResource MetricLabelText}" />
                    <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                        <TextBlock Text="{Binding SignalQuality}" Style="{DynamicResource LargeValueText}"
                                   Foreground="{Binding SignalQuality, Converter={StaticResource SignalToColor}}" />
                        <TextBlock Text="%" FontSize="16" Foreground="{DynamicResource TextMutedBrush}"
                                   VerticalAlignment="Bottom" Margin="2,0,0,6" />
                    </StackPanel>
                    <TextBlock Style="{DynamicResource MetricLabelText}">
                        <Run Text="{Binding RssiDbm, StringFormat={}{0} dBm}" />
                    </TextBlock>
                </StackPanel>
            </Border>

            <!-- Gateway Latency -->
            <Border Grid.Column="1" Style="{DynamicResource CardPanel}">
                <StackPanel>
                    <TextBlock Text="GATEWAY" Style="{DynamicResource MetricLabelText}" />
                    <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                        <TextBlock Text="{Binding GatewayLatency, StringFormat={}{0:F1}}"
                                   Style="{DynamicResource LargeValueText}"
                                   Foreground="{Binding GatewayLatency, Converter={StaticResource LatencyToColor}}" />
                        <TextBlock Text="ms" FontSize="14" Foreground="{DynamicResource TextMutedBrush}"
                                   VerticalAlignment="Bottom" Margin="4,0,0,6" />
                    </StackPanel>
                    <TextBlock Text="{Binding GatewayIp}" Style="{DynamicResource MetricLabelText}" />
                </StackPanel>
            </Border>

            <!-- DNS Latency -->
            <Border Grid.Column="2" Style="{DynamicResource CardPanel}">
                <StackPanel>
                    <TextBlock Text="DNS" Style="{DynamicResource MetricLabelText}" />
                    <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                        <TextBlock Text="{Binding Dns1Latency, StringFormat={}{0:F1}}"
                                   Style="{DynamicResource LargeValueText}"
                                   Foreground="{Binding Dns1Latency, Converter={StaticResource LatencyToColor}}" />
                        <TextBlock Text="ms" FontSize="14" Foreground="{DynamicResource TextMutedBrush}"
                                   VerticalAlignment="Bottom" Margin="4,0,0,6" />
                    </StackPanel>
                    <TextBlock Style="{DynamicResource MetricLabelText}">
                        <Run Text="8.8.8.8" />
                        <Run Text=" | " />
                        <Run Text="{Binding Dns2Latency, StringFormat={}{0:F1}, Mode=OneWay}" />
                        <Run Text="ms" />
                    </TextBlock>
                </StackPanel>
            </Border>

            <!-- Packet Loss -->
            <Border Grid.Column="3" Style="{DynamicResource CardPanel}">
                <StackPanel>
                    <TextBlock Text="PACKET LOSS" Style="{DynamicResource MetricLabelText}" />
                    <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                        <TextBlock Text="{Binding PacketLossPercent, StringFormat={}{0:F1}}"
                                   Style="{DynamicResource LargeValueText}"
                                   Foreground="{Binding PacketLossPercent, Converter={StaticResource LatencyToColor}}" />
                        <TextBlock Text="%" FontSize="16" Foreground="{DynamicResource TextMutedBrush}"
                                   VerticalAlignment="Bottom" Margin="2,0,0,6" />
                    </StackPanel>
                    <TextBlock Style="{DynamicResource MetricLabelText}">
                        <Run Text="{Binding FailedPings, Mode=OneWay}" />
                        <Run Text=" / " />
                        <Run Text="{Binding TotalPings, Mode=OneWay}" />
                        <Run Text=" failed" />
                    </TextBlock>
                </StackPanel>
            </Border>

            <!-- Internet / HTTP -->
            <Border Grid.Column="4" Style="{DynamicResource CardPanel}">
                <StackPanel>
                    <TextBlock Text="INTERNET" Style="{DynamicResource MetricLabelText}" />
                    <StackPanel Orientation="Horizontal" Margin="0,4,0,0">
                        <TextBlock Text="{Binding HttpLatency, StringFormat={}{0:F0}}"
                                   Style="{DynamicResource LargeValueText}"
                                   Foreground="{Binding HttpLatency, Converter={StaticResource LatencyToColor}}" />
                        <TextBlock Text="ms" FontSize="14" Foreground="{DynamicResource TextMutedBrush}"
                                   VerticalAlignment="Bottom" Margin="4,0,0,6" />
                    </StackPanel>
                    <TextBlock Style="{DynamicResource MetricLabelText}">
                        <Run Text="{Binding InternetReachable, Mode=OneWay, StringFormat=Reachable: {0}}" />
                    </TextBlock>
                </StackPanel>
            </Border>
        </Grid>

        <!-- Charts + Info Panel -->
        <Grid Grid.Row="2" Margin="10,0,10,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="3*" />
                <ColumnDefinition Width="1*" MinWidth="220" />
            </Grid.ColumnDefinitions>

            <!-- Charts Column -->
            <Grid Grid.Column="0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <!-- Latency Chart -->
                <Border Grid.Row="0" Style="{DynamicResource CardPanel}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>
                        <TextBlock Grid.Row="0" Text="Latency (ms)" Style="{DynamicResource HeaderText}"
                                   FontSize="14" Margin="0,0,0,4" />
                        <lvc:CartesianChart Grid.Row="1"
                                            Series="{Binding LatencySeries}"
                                            XAxes="{Binding LatencyXAxes}"
                                            YAxes="{Binding LatencyYAxes}"
                                            TooltipPosition="Left"
                                            AnimationsSpeed="00:00:00.200"
                                            ZoomMode="X" />
                    </Grid>
                </Border>

                <!-- Signal Chart -->
                <Border Grid.Row="1" Style="{DynamicResource CardPanel}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>
                        <TextBlock Grid.Row="0" Text="Signal Quality (%)" Style="{DynamicResource HeaderText}"
                                   FontSize="14" Margin="0,0,0,4" />
                        <lvc:CartesianChart Grid.Row="1"
                                            Series="{Binding SignalSeries}"
                                            XAxes="{Binding SignalXAxes}"
                                            YAxes="{Binding SignalYAxes}"
                                            TooltipPosition="Left"
                                            AnimationsSpeed="00:00:00.200"
                                            ZoomMode="X" />
                    </Grid>
                </Border>
            </Grid>

            <!-- Right Info Panel -->
            <Grid Grid.Column="1">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <!-- Wi-Fi Details -->
                <Border Grid.Row="0" Style="{DynamicResource CardPanel}">
                    <StackPanel>
                        <TextBlock Text="Wi-Fi Details" Style="{DynamicResource HeaderText}" FontSize="14" Margin="0,0,0,8" />

                        <TextBlock Text="SSID" Style="{DynamicResource MetricLabelText}" />
                        <TextBlock Text="{Binding Ssid}" Style="{DynamicResource MetricValueText}" />

                        <TextBlock Text="BSSID" Style="{DynamicResource MetricLabelText}" Margin="0,6,0,0" />
                        <TextBlock Text="{Binding Bssid}" Style="{DynamicResource MetricValueText}" FontSize="11" />

                        <TextBlock Text="BAND / CHANNEL" Style="{DynamicResource MetricLabelText}" Margin="0,6,0,0" />
                        <TextBlock Style="{DynamicResource MetricValueText}">
                            <Run Text="{Binding Band, Mode=OneWay}" />
                            <Run Text=" / Ch " />
                            <Run Text="{Binding Channel, Mode=OneWay}" />
                        </TextBlock>

                        <TextBlock Text="PHY TYPE" Style="{DynamicResource MetricLabelText}" Margin="0,6,0,0" />
                        <TextBlock Text="{Binding PhyType}" Style="{DynamicResource MetricValueText}" />

                        <TextBlock Text="LINK SPEED" Style="{DynamicResource MetricLabelText}" Margin="0,6,0,0" />
                        <TextBlock Style="{DynamicResource MetricValueText}">
                            <Run Text="{Binding LinkSpeedMbps, Mode=OneWay}" />
                            <Run Text=" Mbps" />
                        </TextBlock>
                    </StackPanel>
                </Border>

                <!-- Network Details -->
                <Border Grid.Row="1" Style="{DynamicResource CardPanel}">
                    <StackPanel>
                        <TextBlock Text="Network" Style="{DynamicResource HeaderText}" FontSize="14" Margin="0,0,0,8" />

                        <TextBlock Text="LOCAL IP" Style="{DynamicResource MetricLabelText}" />
                        <TextBlock Text="{Binding LocalIp}" Style="{DynamicResource MetricValueText}" />

                        <TextBlock Text="GATEWAY" Style="{DynamicResource MetricLabelText}" Margin="0,6,0,0" />
                        <TextBlock Text="{Binding GatewayIp}" Style="{DynamicResource MetricValueText}" />

                        <TextBlock Text="DNS SERVERS" Style="{DynamicResource MetricLabelText}" Margin="0,6,0,0" />
                        <TextBlock Text="{Binding DnsServers}" Style="{DynamicResource MetricValueText}"
                                   TextWrapping="Wrap" FontSize="11" />

                        <TextBlock Text="ADAPTER" Style="{DynamicResource MetricLabelText}" Margin="0,6,0,0" />
                        <TextBlock Text="{Binding AdapterName}" Style="{DynamicResource MetricValueText}" FontSize="11" />
                    </StackPanel>
                </Border>

                <!-- DNS Query Results -->
                <Border Grid.Row="2" Style="{DynamicResource CardPanel}">
                    <StackPanel>
                        <TextBlock Text="DNS Query" Style="{DynamicResource HeaderText}" FontSize="14" Margin="0,0,0,8" />

                        <TextBlock Text="8.8.8.8 (Google)" Style="{DynamicResource MetricLabelText}" />
                        <TextBlock Style="{DynamicResource MetricValueText}"
                                   Foreground="{Binding DnsQueryLatency1, Converter={StaticResource LatencyToColor}}">
                            <Run Text="{Binding DnsQueryLatency1, StringFormat={}{0:F1}, Mode=OneWay}" />
                            <Run Text=" ms" />
                        </TextBlock>

                        <TextBlock Text="1.1.1.1 (Cloudflare)" Style="{DynamicResource MetricLabelText}" Margin="0,6,0,0" />
                        <TextBlock Style="{DynamicResource MetricValueText}"
                                   Foreground="{Binding DnsQueryLatency2, Converter={StaticResource LatencyToColor}}">
                            <Run Text="{Binding DnsQueryLatency2, StringFormat={}{0:F1}, Mode=OneWay}" />
                            <Run Text=" ms" />
                        </TextBlock>
                    </StackPanel>
                </Border>
            </Grid>
        </Grid>

        <!-- Status Bar -->
        <Border Grid.Row="3" Background="{DynamicResource SurfaceBrush}" Padding="12,6">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0" Foreground="{DynamicResource TextMutedBrush}" FontSize="11">
                    <Run Text="Last update: " />
                    <Run Text="{Binding LastUpdate, StringFormat={}{0:HH:mm:ss}, Mode=OneWay}" />
                </TextBlock>
                <TextBlock Grid.Column="2" Foreground="{DynamicResource TextMutedBrush}" FontSize="11">
                    <Run Text="Uptime: " />
                    <Run Text="{Binding UptimeText, Mode=OneWay}" />
                    <Run Text=" | MAC: " />
                    <Run Text="{Binding MacAddress, Mode=OneWay}" />
                </TextBlock>
            </Grid>
        </Border>
    </Grid>
</Window>
