<Window x:Class="HomeLinkMonitor.Views.TracerouteWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:conv="clr-namespace:HomeLinkMonitor.Converters"
        Title="Traceroute - HomeLink Monitor"
        Width="650" Height="500"
        MinWidth="500" MinHeight="350"
        WindowStartupLocation="CenterOwner"
        Icon="/Assets/app.ico"
        Background="{DynamicResource BackgroundBrush}"
        Foreground="{DynamicResource TextPrimaryBrush}">

    <Window.Resources>
        <conv:BoolToVisibilityConverter x:Key="BoolToVis" />
        <conv:InverseBoolConverter x:Key="InverseBool" />
    </Window.Resources>

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Target input + buttons -->
        <Grid Grid.Row="0" Margin="0,0,0,12">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <TextBlock Grid.Column="0" Text="Target:" VerticalAlignment="Center"
                       Foreground="{DynamicResource TextSecondaryBrush}" Margin="0,0,8,0" />
            <TextBox Grid.Column="1" Text="{Binding Target, UpdateSourceTrigger=PropertyChanged}"
                     IsEnabled="{Binding IsRunning, Converter={StaticResource InverseBool}}"
                     VerticalAlignment="Center" Margin="0,0,8,0" />
            <Button Grid.Column="2" Content="Trace" Style="{DynamicResource AccentButton}"
                    Command="{Binding RunCommand}"
                    IsEnabled="{Binding IsRunning, Converter={StaticResource InverseBool}}"
                    Margin="0,0,4,0" />
            <Button Grid.Column="3" Content="Cancel" Style="{DynamicResource SubtleButton}"
                    Command="{Binding CancelCommand}"
                    IsEnabled="{Binding IsRunning}"
                    Margin="0,0,4,0" />
            <Button Grid.Column="4" Content="Map" Style="{DynamicResource SubtleButton}"
                    Command="{Binding ShowMapCommand}" />
        </Grid>

        <!-- Results ListView -->
        <ListView Grid.Row="1" ItemsSource="{Binding Hops}"
                  Background="{DynamicResource SurfaceBrush}"
                  Foreground="{DynamicResource TextPrimaryBrush}"
                  BorderBrush="{DynamicResource BorderBrush}"
                  BorderThickness="1">
            <ListView.View>
                <GridView>
                    <GridViewColumn Header="Hop" Width="50"
                                    DisplayMemberBinding="{Binding Hop}" />
                    <GridViewColumn Header="Address" Width="140"
                                    DisplayMemberBinding="{Binding Address}" />
                    <GridViewColumn Header="Hostname" Width="240"
                                    DisplayMemberBinding="{Binding HostName}" />
                    <GridViewColumn Header="Latency" Width="90">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock>
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Text" Value="{Binding LatencyMs, StringFormat={}{0:F1} ms}" />
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsTimeout}" Value="True">
                                                    <Setter Property="Text" Value="*" />
                                                    <Setter Property="Foreground" Value="{DynamicResource WarningBrush}" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>
                    <GridViewColumn Header="Status" Width="80">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <TextBlock>
                                    <TextBlock.Style>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Text" Value="OK" />
                                            <Setter Property="Foreground" Value="{DynamicResource GoodBrush}" />
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsTimeout}" Value="True">
                                                    <Setter Property="Text" Value="Timeout" />
                                                    <Setter Property="Foreground" Value="{DynamicResource WarningBrush}" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </TextBlock.Style>
                                </TextBlock>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>
                </GridView>
            </ListView.View>
        </ListView>

        <!-- Status bar -->
        <TextBlock Grid.Row="2" Text="{Binding StatusText}" Margin="0,8,0,0"
                   Foreground="{DynamicResource TextMutedBrush}" FontSize="12" />
    </Grid>
</Window>
